---
author: "@brocktibert"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r echo=F, warning=FALSE, message=FALSE}
options(stringsAsFactors=FALSE)
knitr::opts_chunk$set(comment = NA)
knitr::opts_chunk$set(warning = F)
knitr::opts_chunk$set(message = F)

## load the packages
library(stattleshipR)
library(dplyr)

```



## Before you begin

This document is meant to be a quick start guide and introduce the new features added to the package in version `1.0`.  For an excellent overview of what is possible check out this [great post](http://blog.stattleship.com/stop-scraping-for-sports-data-start-stattleshipping/).

If you don't already have an API token, you will need to signup for our API in order to use the `stattleshipR` package.  Please visit [our site](https://www.stattleship.com/) to get started.  

Once you have a token, simply install the package with:

```{r eval=FALSE}
install.packages("devtools")  
devtools::install_github("stattleship/stattleship-r")

## Load the stattleshipR package
library(stattleshipR)  
```


Lastly, you will need to initalize your token with `set_token`. 

```{r eval=FALSE}
set_token("your-API-token-goes-here") 
```


It's worth nothing that you may want to store your token as an environment variable.  In that case, you can load it with:

```{r}
set_token(Sys.getenv("STATTLE_TOKEN"))
```

where `STATTLE_TOKEN` is the environment variable on your system.

We also recommend the `dplyr`.  

```{r eval=FALSE}
library(dplyr)
```

If you don't have `dplyr`, you can install it with `install.packages(dplyr)`.

## What's new

As noted in Tanya's post, you see that the workhorse of the package is `ss_get_result` which allows you to access our entire API.  However, it was obvious that we wanted to make a few things easier, especially for common use-cases.  The following helpers were added in version `1.0`.

#### General Helpers  

-  `list_sideload`  
-  `parse_stattle`
-  `ss_keep_cols`

#### Sport-specific helpers

-  `*_teams`  
-  `*_games`  
-  `*_players`  
-  `*_injuries`  

where `*` is `hockey`, `football`, `baseball`, and `basketball`.  For example, `hockey_injuries` or `baseball_teams`.

#### Game logs

We also added helpers around team and player game logs, respectively.

- `ss_team_logs`  
-  `ss_player_logs`


## `list_sideload`

In this release, we added `list_sideload` which allows you to evaluate the datasets that get returned from a call to `ss_get_result`.  

Let's make a call to get all of the teams in MLB.

```{r, echo=TRUE, message=FALSE, warning=FALSE, error= FALSE, comment=NA}
teams_raw <- ss_get_result(sport="baseball", league = "mlb", ep = "teams")
```

We added`list_sideload` to view the datasets that come back from `ss_get_result`.  

```{r}
list_sideload(teams_raw)
```

In this particular case, not only did we get return the `teams`, but we have other data as well, which can be used to merge on additional facts and features to our data.  


## `parse_stattle`  

Previously, calls to `ss_get_result` would require that you do the `do.call` dance to pull out `data_frames` of data.  Below is an example of using `do.call` to grab the `teams` dataset, and printing the first few team hashtags.

```{r}
mlb_teams <- do.call('rbind', lapply(teams_raw, function(x) x$teams))
head(mlb_teams$hashtag)
```

But now, you can do this more succintly with `parse_stattle`

```{r}
mlb_teams2 <- parse_stattle(teams_raw, "teams")
head(mlb_teams2$hashtag)
```


## Sport specific helpers

As noted above, we added helpers around the `teams`, `games`, `players` and `injuries` endpoints in order to make it easier to extract the data of interest.  In short, you won't have to worry about merging a variety of data; we simply return a complete dataset for your to work with.

For example, instead of using `ss_get_result` to pull out the teams in MLB, you can use `baseball_teams`

```{r}
mlb_teams3 <- baseball_teams()
head(mlb_teams3$team_hashtag)
```

You will notice above that you had to change `hashtag` to `team_hashtag`.  This is an artifact of the merging process in order to retain the variables for you to use.  

With that in mind, let's look at all of the data that came back in that simple call

```{r}
colnames(mlb_teams3)
```

How about isolating the patriots games, both home and away, in cloudy games.

```{r}
pats_games <- football_games() %>% 
  filter(weather_conditions=="cloudy")
tbl_df(pats_games) %>% select(., slug, passing_touch_downs) %>% print(n=5)
```








